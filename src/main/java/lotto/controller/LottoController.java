package lotto.controller;

import java.util.ArrayList;
import java.util.List;
import lotto.domain.BonusNumber;
import lotto.domain.Cost;
import lotto.domain.LotteryDrawMachine;
import lotto.domain.Lotto;
import lotto.domain.LottoGroup;
import lotto.domain.WinningLotto;
import lotto.domain.result.Profit;
import lotto.domain.result.Result;
import lotto.view.Input;
import lotto.view.Output;

public class LottoController {

    public void run() {
        try {
            Cost cost = createCost();

            int purchaseCost = cost.getCost();
            int purchaseCount = purchaseCost / 1000;
            Output.purchaseCountNotification(purchaseCount);

            LottoGroup lottoGroup = createLottoGroup(purchaseCount);
            WinningLotto winningLotto = createWinningLotto();
            BonusNumber bonusNumber = createBonusNumber(winningLotto);

            Result result = createResult(lottoGroup, winningLotto, bonusNumber);
            Output.printWinningStatistics(result);

            Profit profit = createProfit(purchaseCost, result);
            Output.earningsRateNotification(profit.getEarningsRate());

        } catch (IllegalArgumentException ex) {
            Output.printError(ex.getMessage());
        }
    }

    private Result createResult(LottoGroup lottoGroup, WinningLotto winningLotto, BonusNumber bonusNumber) {
        return new Result(lottoGroup, winningLotto, bonusNumber);
    }

    private Profit createProfit(int purchaseCost, Result result) {
        return new Profit(purchaseCost, result);
    }

    private Cost createCost() {
        return new Cost(Input.inputCost());
    }

    private LottoGroup createLottoGroup(int purchaseCount) {
        LotteryDrawMachine lotteryDrawMachine = new LotteryDrawMachine();
        List<Lotto> lotteries = new ArrayList<>();
        for (int count = 0; count < purchaseCount; count++) {
            Lotto lotto = createLotto(lotteryDrawMachine);
            Output.printLotteryNumbers(lotto.getNumbers());
            lotteries.add(lotto);
        }
        return new LottoGroup(lotteries);
    }

    private Lotto createLotto(LotteryDrawMachine lotteryDrawMachine) {
        return new Lotto(lotteryDrawMachine.drawLotteryNumbers());
    }

    private WinningLotto createWinningLotto() {
        return new WinningLotto(Input.inputWinningNumbers());
    }

    private BonusNumber createBonusNumber(WinningLotto winningLotto) {
        return new BonusNumber(Input.inputBonusNumbers(), winningLotto);
    }
}
